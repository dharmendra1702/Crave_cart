<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Menu | {{ restaurant.name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    {% load static %}
    {% load cart_extras %}

    <link rel="icon" href="{% static 'images/faviconn.png' %}">
    <link rel="stylesheet" href="{% static 'css/custom_show_style.css' %}">
</head>
<style>
    .qty-box {
    display: flex;
    align-items: center;
    gap: 12px;
}

.qty-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: none;
    background: #000;
    color: #fff;
    font-size: 20px;
    cursor: pointer;
}

.qty-count {
    min-width: 20px;
    text-align: center;
    font-weight: bold;
}

.hidden {
    display: none !important;
}
</style>

<body>
<div class="page">

<!-- ================= HEADER ================= -->
<header class="header">
    <div class="brand">
        <a href="{% url 'home' %}" class="logo-link">
            <img src="{% static 'images/logoo.png' %}" alt="Crave Cart Logo" class="logo">
        </a>
    </div>

    <div class="header-actions">
        <button class="icon-btn" title="Help"><span class="icon">‚ùì</span></button>
        <!-- THEME TOGGLE -->
    <button class="icon-btn theme-btn" onclick="toggleTheme()" title="Toggle theme">
        <span id="themeIcon", class = "icon">üåô</span>
    </button>



    <!-- CART (BETWEEN THEME & PROFILE) -->
    {% if request.session.username %}
        <a href="{% url 'view_cart' %}" class="icon-btn cart-btn" title="Cart">
            <span class="cart-icon-box">
                <img
                    id="cartIcon"
                    alt="Cart"
                >
                {% if cart_count and cart_count > 0 %}
                    <span class="cart-count">{{ cart_count }}</span>
                {% endif %}
            </span>
        </a>
    {% endif %}



        <div class="profile-menu">
            <button class="profile-avatar" onclick="toggleProfileMenu(event)">
                <img src="{% static 'images/profile.png' %}" alt="Profile">
            </button>

            <div class="profile-dropdown" id="profileDropdown">
                <div class="profile-header">
                    <img src="{% static 'images/profile.png' %}" class="profile-pic">
                    <strong>{{ username|capfirst }}</strong>
                </div>

                <div class="dropdown-divider"></div>

                <a href="#" class="dropdown-item">üë§ My Profile</a>
                <a href="#" class="dropdown-item">üõí Order History</a>
                <div class="dropdown-divider"></div>

                <a href="javascript:void(0)"
                   class="dropdown-item logout"
                   onclick="openLogoutModal()">üö™ Log Out</a>
            </div>
        </div>
    </div>
</header>

<!-- ================= MAIN ================= -->
<main class="content content-top">
<div class="restaurant-container">
{% csrf_token %}

    <h2 class="page-title">{{ restaurant.name }} Menu</h2>

    {% if itemList %}
    <div class="table-wrapper">
        <table class="modern-table">
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Image</th>
                    <th>Description</th>
                    <th>Price</th>
                    <th>Type</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
            {% for item in itemList %}
            <tr>
                <td><strong>{{ item.name }}</strong></td>

                <td>
                    <img src="{{ item.picture }}" class="restaurant-img">
                </td>

                <td>{{ item.description }}</td>
                <td>‚Çπ{{ item.price }}</td>

                <td>
                    {% if item.vegeterian %}
                        üü¢ Veg
                    {% else %}
                        üî¥ Non-Veg
                    {% endif %}
                </td>

                <td>
                    <div class="qty-wrapper">
                        {% if cart_quantities|get_item:item.id %}
                            <!-- Item already in cart -->
                            <button class="add-btn hidden">ADD</button>

                            <div class="qty-box">
                                <button class="qty-btn"
                                        onclick="decreaseQty({{ item.id }}, this)">‚àí</button>

                                <span class="qty-count">
                                    {{ cart_quantities|get_item:item.id }}
                                </span>

                                <button class="qty-btn"
                                        onclick="increaseQty({{ item.id }}, this)">+</button>
                            </div>
                        {% else %}
                            <!-- Not in cart -->
                            <button class="add-btn"
                                    onclick="addToCart({{ item.id }}, this)">ADD</button>

                            <div class="qty-box hidden">
                                <button class="qty-btn"
                                        onclick="decreaseQty({{ item.id }}, this)">‚àí</button>

                                <span class="qty-count">1</span>

                                <button class="qty-btn"
                                        onclick="increaseQty({{ item.id }}, this)">+</button>
                            </div>
                        {% endif %}
                    </div>
                </td>

            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
        <p>No menu items available.</p>
    {% endif %}

    <div class="back-center">
        <a href="{% url 'open_customer_show_restaurants' %}" class="btn outline">
            ‚Üê Back to Restaurants
        </a>
    </div>

</div>
</main>

<!-- ================= FOOTER ================= -->
<footer class="footer">
    ¬© 2025 Crave Cart
</footer>

</div>

<!-- ================= LOGOUT MODAL ================= -->
<div class="logout-overlay" id="logoutOverlay">
    <div class="logout-modal">
        <h3>Confirm Logout</h3>
        <p>Are you sure you want to log out?</p>
        <button class="btn primary full-width" onclick="confirmLogout()">
            Yes, Log Out
        </button>
    </div>
</div>

<!-- ================= JS ================= -->
<script src="{% static 'js/theme.js' %}"></script>

<script>

const CART_LIGHT = "{% static 'images/dark-cart.png' %}";
const CART_DARK  = "{% static 'images/light-cart.png' %}";

function toggleProfileMenu(event) {
    event.stopPropagation();
    document.getElementById("profileDropdown").classList.toggle("show");
}

document.addEventListener("click", function () {
    const dropdown = document.getElementById("profileDropdown");
    if (dropdown) dropdown.classList.remove("show");
});

function openLogoutModal() {
    document.getElementById("logoutOverlay").classList.add("show");
}

function confirmLogout() {
    window.location.href = "{% url 'logout' %}";
}

function addItem(btn) {
    const wrapper = btn.parentElement;
    btn.classList.add("hidden");
    wrapper.querySelector(".qty-box").classList.remove("hidden");
}



function addItem(btn, qty = 1) {
    const wrapper = btn.closest(".qty-wrapper");
    btn.classList.add("hidden");
    const box = wrapper.querySelector(".qty-box");
    box.classList.remove("hidden");
    box.querySelector(".qty-count").textContent = qty;
}


function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
        const cookies = document.cookie.split(";");
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + "=")) {
                cookieValue = decodeURIComponent(
                    cookie.substring(name.length + 1)
                );
                break;
            }
        }
    }
    return cookieValue;
}

const csrfToken = getCookie("csrftoken");
</script>

</body>
</html>
